{% extends "survey/base.html" %}
{% load guest_user %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Dish{% endblock %}

{% block subtitle %}Step 2: Tell us about food!{% endblock %}

{% block subcontent %}

<div class="my-4">
<p>
  <b>We would like you to think about a dish you consider to be a part of your home(s) and cultural background(s).</b></p>
<p>
  If you have an image of the dish, we’d like to take this opportunity to ask you to share it with us for research purposes. However, there’s absolutely no need to worry if you don’t have an image to share!
</p>
<form method="post" enctype="multipart/form-data" novalidate>
  {% csrf_token %}
  <button type="submit" class="btn btn-secondary m-1 p-2">I don't have a photo. Take me to the next step.</button>
</form>
<form method="post" enctype="multipart/form-data" novalidate>
  {% csrf_token %}
  {% for field in form %}
    {% if field.name == "image" %}
      <hr />
      <p>
        If you are able and would like to do so, <b>please upload a photo of this dish that you took</b>.
      </p>
      <p>Before you upload the photo, please make sure that</p>
      <ul>
        <li>
            You haven't downloaded this photo from the Internet (this is a photo that you took)
        </li>
        <li>
          You allow us to use and disseminate this image for research (non-commercial) purposes
        </li>
        <li>
          There are no identifiable humans in the photo (you are welcome to crop the image to remove any people)
        </li>
        <li>
          The image is a photograph and not generated by AI
        </li>
      </ul>
    <div class="form-group mb-4">
    <b>{{ field.label }}{% if field.required %}(*required){% endif %}</b>
    {% render_field field class="form-control" onchange="loadFile(event)" %}
    </div>
    <img id="image-preview" src="{% if dish %}{% if dish.image %}{{ dish.image.url }}{% endif %}{% endif %}" style="max-width: 420px; width: 100%;"/>

    {% elif field.name == "image_details" %}
    <hr />
    <p><b>Photo caption</b></p>
    <p>
      We'd love for you to describe everything in the image you have shared. We ask that you explain everything in the image as if you are describing it to someone who can’t see the image. You can also think about it as if how you would want to caption the image to help a machine understand.
    </p>
    <div class="form-group mb-4">
    {% include 'components/formfield.html' %}
    </div>

    {% else %}
    <div class="form-group mb-4">
    {% include 'components/formfield.html' %}
    </div>
    {% endif %}

  {% endfor %}
  <small>
    For an example of how to fill this in, please see these examples of Àmàlà (yam flour) from Nigeria, and Soba in hot broth (Kake-soba) with tempura (天かけそば ) from Japan: <a href="#image-example" data-bs-toggle="collapse" data-bs-target="#image-example">[Show example]</a>
  </small>
  <div id="image-example" class="collapse">
    <img src="{% static 'assets/img/alt_text_example.jpg' %}" class="img-fluid"
         alt="The left-hand image shows a bowl with Àmàlà (yam flour), blackish and solid, with Ewédú (Jute leaves) soup with Iru (locust beans). The Ewédú is greenish in color. In the image, there is also blended tomato sauce with Ata Rodo (scotch bonnet), reddish in color and two small beef.
              The right-hand image shows buckwheat noodles (soba) served with Tempura. The soba in a bowl of warm broth of dipping sauce to the right. Tempura of a variety of vegetables and shrimp is behind a small bowl of tempura dipping sauce on the left. In the centre there is a small plate of cut spring onions, next to a pair of chopsticks."/>
  </div>

  <br class="clear"/>
  <br />
  <a href="{% url 'survey:dish_list' %}" class="btn btn-outline-secondary m-1">Back</a>
  <button type="submit" class="btn btn-primary m-1">Save and continue</button>
</form>
</div>
{% endblock %}

{% block extrascript %}

<script>
  var loadFile = function(event) {
    var output = document.getElementById('image-preview');
    output.src = URL.createObjectURL(event.target.files[0]);
    output.onload = function() {
      URL.revokeObjectURL(output.src) // free memory
    }
  };
</script>

{% endblock %}
